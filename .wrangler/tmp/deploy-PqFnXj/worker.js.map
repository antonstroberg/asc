{
  "version": 3,
  "sources": ["../../../worker.ts"],
  "sourceRoot": "/Users/andreasstroberg/strobergconsulting/strobergconsulting/.wrangler/tmp/deploy-PqFnXj",
  "sourcesContent": ["type Env = {\n  ASSETS: Fetcher;\n  CONTACT_WEBHOOK_URL?: string;\n  MAILERLITE_API_TOKEN?: string;\n  MAILERLITE_GROUP_ID?: string;\n};\n\nasync function forwardToWebhook(url: string, payload: Record<string, unknown>) {\n  const isSlack = url.includes(\"hooks.slack.com\");\n  if (isSlack) {\n    const text = [\n      `*New message from ${payload.name ?? \"Unknown\"}*`,\n      payload.email ? `Email: ${payload.email}` : \"\",\n      payload.company ? `Company: ${payload.company}` : \"\",\n      payload.message ? `Message:\\n>${String(payload.message).replace(/\\n/g, \"\\n>\")}` : \"\",\n    ]\n      .filter(Boolean)\n      .join(\"\\n\");\n\n    return fetch(url, {\n      method: \"POST\",\n      headers: { \"content-type\": \"application/json\" },\n      body: JSON.stringify({ text }),\n    });\n  }\n\n  return fetch(url, {\n    method: \"POST\",\n    headers: { \"content-type\": \"application/json\" },\n    body: JSON.stringify(payload),\n  });\n}\n\nasync function handleContact(request: Request, env: Env) {\n  if (!request.headers.get(\"content-type\")?.includes(\"application/json\")) {\n    return new Response(JSON.stringify({ error: \"Expected JSON body\" }), {\n      status: 400,\n      headers: { \"content-type\": \"application/json\" },\n    });\n  }\n\n  let payload: any;\n  try {\n    payload = await request.json();\n  } catch {\n    return new Response(JSON.stringify({ error: \"Invalid JSON body\" }), {\n      status: 400,\n      headers: { \"content-type\": \"application/json\" },\n    });\n  }\n\n  const { name, email, company = \"\", message } = payload ?? {};\n  if (!name || !email || !message) {\n    return new Response(JSON.stringify({ error: \"Name, email, and message are required.\" }), {\n      status: 400,\n      headers: { \"content-type\": \"application/json\" },\n    });\n  }\n\n  const normalized = {\n    name,\n    email,\n    company,\n    message,\n    receivedAt: new Date().toISOString(),\n    userAgent: request.headers.get(\"user-agent\") ?? \"\",\n  };\n\n  if (env.MAILERLITE_API_TOKEN) {\n    console.log(\"[contact] sending to MailerLite\", {\n      hasGroup: Boolean(env.MAILERLITE_GROUP_ID),\n      email,\n    });\n    const subscriberPayload: Record<string, unknown> = {\n      email,\n      fields: {\n        name,\n        company,\n        message,\n      },\n    };\n    if (env.MAILERLITE_GROUP_ID) {\n      subscriberPayload.groups = [env.MAILERLITE_GROUP_ID];\n    }\n\n    const mailerliteResponse = await fetch(\"https://connect.mailerlite.com/api/subscribers\", {\n      method: \"POST\",\n      headers: {\n        Authorization: `Bearer ${env.MAILERLITE_API_TOKEN}`,\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(subscriberPayload),\n    });\n\n    console.log(\"[contact] MailerLite response status\", mailerliteResponse.status);\n\n    if (!mailerliteResponse.ok && mailerliteResponse.status !== 409) {\n      const errorBody = await mailerliteResponse.text();\n      console.error(\"MailerLite error:\", mailerliteResponse.status, errorBody);\n      return new Response(\n        JSON.stringify({ error: \"Unable to send message right now. Please try again later.\" }),\n        { status: 502, headers: { \"content-type\": \"application/json\" } },\n      );\n    }\n  }\n\n  if (env.CONTACT_WEBHOOK_URL) {\n    console.log(\"[contact] forwarding payload to webhook\");\n    await forwardToWebhook(env.CONTACT_WEBHOOK_URL, normalized);\n  } else if (!env.MAILERLITE_API_TOKEN) {\n    console.log(\"No MailerLite token or webhook configured. Payload:\", normalized);\n  }\n\n  return new Response(JSON.stringify({ success: true }), {\n    status: 200,\n    headers: { \"content-type\": \"application/json\" },\n  });\n}\n\nexport default {\n  async fetch(request: Request, env: Env) {\n    const url = new URL(request.url);\n\n    if (url.pathname === \"/api/contact\" && request.method === \"POST\") {\n      return handleContact(request, env);\n    }\n\n    return env.ASSETS.fetch(request);\n  },\n};\n"],
  "mappings": "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",
  "names": []
}
